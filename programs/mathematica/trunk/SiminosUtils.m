(*******************************************************************
This file was generated automatically by the Mathematica front end.
It contains Initialization cells from a Notebook file, which
typically will have the same name as this file except ending in
".nb" instead of ".m".

This file is intended to be loaded into the Mathematica kernel using
the package loading commands Get or Needs.  Doing so is equivalent
to using the Evaluate Initialization Cells menu command in the front
end.

DO NOT EDIT THIS FILE.  This entire file is regenerated
automatically each time the parent Notebook file is saved in the
Mathematica front end.  Any changes you make to this file will be
overwritten.
***********************************************************************)

Clear[wd];

wd[]:=StringDrop[Directory[],
      Flatten[StringPosition[Directory[],
              ParentDirectory[Directory[]]] ][[2]]+1];

fp=FourierParameters\[Rule]{-1,1};

uSpatial[u_,L_]:=Module[{ux,uxx,dx,d},d=Dimensions[u][[1]];
    dx=L/(d-1);ux=Table[Null,{d}];
    Do[ux[[i]]=(u[[Mod[i+1,d,1]]]-u[[Mod[i-1,d,1]]])/(2dx),{i,1,d}];
    uxx=Table[Null,{d}];
    Do[uxx[[i]]=(ux[[Mod[i+1,d,1]]]-ux[[Mod[i-1,d,1]]])/(2dx),{i,1,d}];
    Table[{u[[i]],ux[[i]],uxx[[i]]},{i,1,d}]]

\!\(uDer[u_, n_, L_] := Module[{a, d}, \[IndentingNewLine]d = \(Dimensions[u]\)[\([1]\)]; a = Fourier[u, fp]; Do[a[\([k + 1]\)] = \(\((\(-2\) \[Pi]\ I\ k/L)\)\^n\) a[\([k + 1]\)], {k, 0, d/2}]; Do[a[\([d + 1 - k]\)] = Conjugate[a[\([1 + k]\)]], {k, 1, d/2 - 1}]\ ; \ Chop[InverseFourier[a, fp], 10^\(-10\)]]\)

uShiftF[u_,sh_,L_]:=Module[{a,d},d=Dimensions[u][[1]];a=Fourier[u,fp];
    Do[a[[k+1]]=Exp[-2 \[Pi] sh I k/L]a[[k+1]],{k,1,d/2+1}];
    Do[a[[d+1-k]]=Conjugate[a[[1+k]]],{k,1,d/2-1}];
    Chop[InverseFourier[a,fp],10^-9]]

uShiftFTraj[traj_,sh_,L_]:=Map[uShiftF[#,sh,L]&,traj,{1}];

uClose[u_]:=Append[u,u[[1]] ]

uAntiSym[u_]:=
  Module[{uAnt,i,d},d=Dimensions[u][[1]];uAnt=Table[0,{d}];uAnt[[1]]=-u[[1]];
    Do[uAnt[[i+1]]=-u[[d+1-i]],{i,1,d-1}];uAnt]

uAntiImag[u_]:=
  Module[{i,d},d=Dimensions[u][[1]];Table[-u[[Mod[d/2+1-k+1,d,1]]],{k,1,d}]]

uAntiShiftHalf[u_]:=
  Module[{uShift,i,d},d=Dimensions[u][[1]];uShift=Table[0,{d}];
    Do[uShift[[i]]=-u[[Mod[d/2+i,d,1]]],{i,1,d}];uShift]

uShift[u_,s_]:=Module[{uShift,i,d},d=Dimensions[u][[1]];uShift=Table[0,{d}];
    Do[uShift[[i]]=u[[Mod[s+i,d,1]]],{i,1,d}];uShift]

Clear[hby]
hby[x_]:=Hue[0.7+x/2]/;0\[LessEqual]x\[LessEqual]0.5
hby[x_]:=Hue[(x-0.5)/2.5]/;0.5<x\[LessEqual]1

(*plotEnergy[dir_,color_]:=Module[{d,Np,mE,mvx2,mvxx2,Etab,label},
      <<Graphics`Graphics3D`;
      Etab=Import[dir<>"/energy.dat"];
      d=Dimensions[Etab][[2]];
      Np=Dimensions[Etab][[1]];
      mE=Sum[Etab[[i,1]],{i,1,Np}]/Np;
      mvx2=Sum[Etab[[i,2]],{i,1,Np}]/Np;
      mvxx2=Sum[Etab[[i,3]],{i,1,Np}]/Np;
      label=StringDrop[dir,Flatten[StringPosition[dir,"/"]][[-1]]];
      pm[label]=
        ListPlot[{{mvx2,mvxx2}},PlotStyle\[Rule]{color,PointSize[pt]},
          DisplayFunction\[Rule]Identity];
      pme[label]=
        ScatterPlot3D[{{mE,mvx2,mvxx2}},PlotStyle\[Rule]{color,PointSize[pt]},
          DisplayFunction\[Rule]Identity];
      plt[label]=
        ListPlot[TakeColumns[Etab,{2,3}],PlotJoined\[Rule]True,
          PlotRange\[Rule]All,AspectRatio\[Rule]1,
          PlotStyle\[Rule]{color,Thickness[thck]}];
      plte[label]=
        ScatterPlot3D[Etab,PlotJoined\[Rule]True,
          PlotStyle\[Rule]{color,Thickness[thck]}]]*)

ToDir[file_]:=
    StringDrop[StringDrop[file,Flatten[StringPosition[file,"/"]][[-1]]],-4];
ToPeriod[file_]:=ToExpression[StringDrop[StringDrop[ToDir[file],7],-7]];
ToShift[file_]:=ToExpression[StringDrop[ToDir[file],14]];

cInner[a_,b_]:=Conjugate[a].b;

coords[a_,b_,
    ao_]:={cInner[a-ao,b[[1]]],cInner[a-ao,b[[2]]],cInner[a-ao,b[[3]]]}//Chop

fourTraj[traj_]:=Map[Fourier[#,fp]&,traj,{1}];

coordsTraj[traj_,b_,ao_]:=Map[coords[#,b,ao]&,traj,{1}];

UnsortedUnion[x_List]:=
  Module[{len=Length[x],tmp},
    tmp=Split[Sort[Transpose[{x,Range[len]}]],(#1[[1]]===#2[[1]]&)][[All,1]];
    Sort[Transpose[RotateLeft[Transpose[tmp]]]][[All,2]]]

gsorth[x_]:=Module[{y,Nv,d,sm},Nv=Dimensions[x][[1]];d=Dimensions[x][[2]];
    y=Table[Null,{Nv}];y[[1]]=x[[1]]/Norm[x[[1]]];
    Do[sm=Sum[Conjugate[y[[j-k]]].x[[j]]y[[j-k]],{k,1,j-1}];
      y[[j]]=(x[[j]]-sm)/Norm[x[[j]]-sm],{j,2,Nv}];y]

interpTraj[file_,Npt_,Nplt_,NpS_,rSkip_,nd_]:=
  Module[{vfile,vi,v,p,ds,s,dS,adum,a1s,a2s,a3s,aStab},vfile=OpenRead[file];
    aStab=Table[Null,{Npt}];
    Do[vi=ReadList[vfile,Number,nd*Nplt,RecordLists\[Rule]True];
      v=Take[vi,{1,Dimensions[vi][[1]],rSkip}];
      p=coordsTraj[fourTraj[v],b,a2];
      ds=Table[Norm[p[[i+1]]-p[[i]]],{i,1,Nplt-1}];
      s=Table[Null,{Dimensions[ds][[1]]+1}];
      s[[1]]=0;
      Do[s[[i+1]]=s[[i]]+ds[[i]],{i,1,Dimensions[ds][[1]]}];
      dS=s[[Dimensions[s][[1]]]]/NpS;
      adum=TakeColumns[p,{1}]//Flatten;
      a1s=Table[{s[[i]],adum[[i]]},{i,1,Dimensions[s][[1]]}];
      adum=TakeColumns[p,{2}]//Flatten;
      a2s=Table[{s[[i]],adum[[i]]},{i,1,Dimensions[s][[1]]}];
      adum=TakeColumns[p,{3}]//Flatten;
      a3s=Table[{s[[i]],adum[[i]]},{i,1,Dimensions[s][[1]]}];
      aS={Interpolation[a1s],Interpolation[a2s],Interpolation[a3s]};
      aStab[[j]]=
        Table[{aS[[1]][sx*dS],aS[[2]][sx*dS],aS[[3]][sx*dS]},{sx,1,NpS}],{j,1,
        Npt}];
    Close[vfile];
    aStab]

apPoinc[traj_,coord_]:=Module[{cros,ctraj},cros={Null};
    ctraj=Take[traj,All,{coord}]//Flatten;
    Do[If[(ctraj[[i-1]]>0)&&(ctraj[[i]]\[LessEqual]0),
        cros=Append[cros,{i}]],{i,2,Dimensions[ctraj][[1]]}];
    cros=Drop[cros,1];
    (Extract[traj,cros]+Extract[traj,cros-1])/2]


d1[x_List,t_]:=D[#,t]&/@x;

d2[x_List,t_]:=D[#,t,t]&/@x;

norm[x_List]:=x/Sqrt[x.x];

FrenetFrame[x_List,t_,phi_,r_]:=
    Module[{xp,xpp,tangent,binormal,normal},xp=d1[x,t];
      xpp=d2[x,t];
      tangent=norm[xp];
      binormal=norm[Cross[xp,xpp]];
      normal=Cross[binormal,tangent];
      x+normal*r*Cos[phi]+r*binormal*Sin[phi]];


\!\(plotEtab[dir_, c_] := Module[{Etab, Nk, mE, pm, pme, p, pE, pE1, pE2, coord, cros, poinc, plPoinc, rPoincE, rPoinc1, plrPoincE, plrPoinc1}, \[IndentingNewLine]Etab = Import[dir]; \[IndentingNewLine]Nk = \(Dimensions[Etab]\)[\([1]\)]; \[IndentingNewLine] (*\[IndentingNewLine]dif = Map[Greater[#, mind] &, Map[Norm, Etab\  - Table[Ec2, {\(Dimensions[Etab\ ]\)[\([1]\)]}], {1}], {1}]; Etab = Pick[Etab\ , dif]; \[IndentingNewLine]Nk = \(Dimensions[Etab\ ]\)[\([1]\)]; \[IndentingNewLine]ds = Table[Norm[Etab\ [\([i + 1]\)] - Etab\ [\([i]\)]], {i, 1, \(Dimensions[Etab\ ]\)[\([1]\)] - 1}]; s = Table[Null, {\(Dimensions[ds]\)[\([1]\)] + 1}]; s[\([1]\)] = 0; Do[s[\([i + 1]\)] = s[\([i]\)] + ds[\([i]\)], {i, 1, \(Dimensions[ds]\)[\([1]\)]}]; \[IndentingNewLine]dS = s[\([\(Dimensions[s]\)[\([1]\)]]\)]/Nk; \[IndentingNewLine]adum = TakeColumns[Etab\ , {1}] // Flatten; \[IndentingNewLine]a1s = Union[Table[{s[\([i]\)], adum[\([i]\)]}, {i, 1, \(Dimensions[s]\)[\([1]\)]}]]; \[IndentingNewLine]adum = TakeColumns[Etab\ , {2}] // Flatten; \[IndentingNewLine]a2s = Union[Table[{s[\([i]\)], adum[\([i]\)]}, {i, 1, \(Dimensions[s]\)[\([1]\)]}]]; \[IndentingNewLine]adum = TakeColumns[Etab\ , {3}] // Flatten; \[IndentingNewLine]a3s = Union[Table[{s[\([i]\)], adum[\([i]\)]}, {i, 1, \(Dimensions[s]\)[\([1]\)]}]]; aS = {Interpolation[a1s], Interpolation[a2s], Interpolation[a3s]}; Etab\  = Table[{\(aS[\([1]\)]\)[s*dS], \(aS[\([2]\)]\)[s*dS], \(aS[\([3]\)]\)[s*dS]}, {s, 1, Nk}];\[IndentingNewLine]*) \[IndentingNewLine]p\  = ListPlot[AppendRows[TakeColumns[Etab, {2}], TakeColumns[Etab, {3}] - TakeColumns[Etab, {2}]]\ \ , DisplayFunction -> \ Identity, PlotJoined -> True, AspectRatio -> Automatic, PlotStyle -> \ c\ , FrameLabel -> \ {\*"\"\<<(\!\(u\_x\)\!\(\()\^2\)\)>\>\"", \*"\"\<<(\!\(u\_xx\)\!\(\()\^2\)\)>-<(\!\(u\_x\)\!\(\()\^2\)\)>\>\""}]; \[IndentingNewLine]pE = ScatterPlot3D[AppendRows[TakeColumns[Etab, {1}], TakeColumns[Etab, {2}], TakeColumns[Etab, {3}] - TakeColumns[Etab, {2}]]\ \ , DisplayFunction -> \ Identity, PlotJoined -> True, PlotRange -> All, AspectRatio -> Automatic, FrameLabel -> \ {"\<<E>\>", \*"\"\<<(\!\(u\_x\)\!\(\()\^2\)\)>\>\"", \*"\"\<<(\!\(u\_xx\)\!\(\()\^2\)\)>\>\""}, PlotStyle -> \ {c\ }]; \[IndentingNewLine]pE1 = ListPlot[AppendRows[TakeColumns[Etab, {1}], TakeColumns[Etab, {2}]]\ \ , DisplayFunction -> \ Identity, PlotJoined -> True, PlotRange -> All, AspectRatio -> Automatic, FrameLabel -> \ {"\<E\>", \*"\"\<<(\!\(u\_x\)\!\(\()\^2\)\)>\>\""}, PlotStyle -> \ c\ ]; \[IndentingNewLine]pE2 = ListPlot[AppendRows[TakeColumns[Etab, {1}], TakeColumns[Etab, {3}] - TakeColumns[Etab, {2}]]\ \ , DisplayFunction -> \ Identity, PlotJoined -> True, PlotRange -> All, AspectRatio -> Automatic, FrameLabel -> \ {\*"\"\<<(\!\(u\_x\)\!\(\()\^2\)\)>\>\"", \*"\"\<<(\!\(u\_xx\)\!\(\()\^2\)\)>-<(\!\(u\_x\)\!\(\()\^2\)\)>\>\""}, PlotStyle -> \ c\ ]; \[IndentingNewLine]coord = Etab[\([All, 2]\)] - Etab[\([All, 3]\)]; \ncros = {Null}; \nDo[If[\ \((coord[\([i - 1]\)] > 0)\)\  && \ \((coord[\([i]\)] <= \ 0)\), cros = Append[cros, {i}]], {i, 2, \(Dimensions[coord]\)[\([1]\)]}]; \ncros = Drop[cros, 1]; \npoinc = \((Extract[Etab[\([All, {1, 2}]\)], cros] + Extract[Etab[\([All, {1, 2}]\)], cros - 1])\)/2; \[IndentingNewLine] (*\(plPoinc\  = \([poinc, PlotStyle -> \ {c\ , PointSize[3*pt]}]\);\)*) \nplPoinc\  = Show[Graphics[{c\ , Thickness[connPoincThck], Map[Circle[#, connR] &, poinc]}], AspectRatio -> Automatic\ \ , DisplayFunction -> \ Identity]; \[IndentingNewLine]rPoincE = Table[{poinc[\([i, 1]\)], poinc[\([i + 1, 1]\)]}, {i, 1, \(Dimensions[poinc]\)[\([1]\)] - 1}]; \nrPoinc1 = Table[{poinc[\([i, 2]\)], poinc[\([i + 1, 2]\)]}, {i, 1, \(Dimensions[poinc]\)[\([1]\)] - 1}]; \[IndentingNewLine]plrPoincE\  = ListPlot[rPoincE, PlotRange -> All, PlotStyle -> {PointSize[pt]}\ \ , DisplayFunction -> \ Identity, AspectRatio -> Automatic]; \[IndentingNewLine]plrPoinc1\  = ListPlot[rPoinc1, PlotRange -> All, PlotStyle -> {PointSize[pt]}\ \ , DisplayFunction -> \ Identity, AspectRatio -> Automatic]; \[IndentingNewLine]{p, pE, pE1, pE2}\[IndentingNewLine]]\)