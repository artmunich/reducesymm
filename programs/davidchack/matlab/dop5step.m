function [ynew, gnew, erry, errg] = dop5step(ode, y0, g0, h);

switch 2,
case 1,   %%% DOPRI5 coefficients
%	pow = 1/5;
%	A = [1/5;   3/10;   4/5;   8/9;   1;   1];
	B = [ 1/5   3/40    44/45   19372/6561      9017/3168       35/384        743/8043  
        0     9/40    -56/15  -25360/2187     -355/33         0             0      
        0     0       32/9    64448/6561      46732/5247      500/1113      275/618   
        0     0       0       -212/729        49/176          125/192       1321/1920  
        0     0       0       0               -5103/18656     -2187/6784    -4851/12997 
        0     0       0       0               0               11/84         121/700   
        0     0       0       0               0               0             -1/40      ];
	E = [71/57600;  0;  -71/16695;  71/1920;  -17253/339200;    22/525;       -1/40      ];
case 2,   %%% HIHA5 coefficients
% pow = 1/5;
% A = [ 2/9;  1/3;    1/2;    3/5;     1;       1      ];
  B = [ 2/9   1/12    1/8     91/500   -11/20   1/12     2/15    
        0     1/4     0       -27/100  27/20    0        0
        0     0       3/8     78/125   12/5     27/32    27/80
        0     0       0       8/125    -36/5    -4/3     -2/15
        0     0       0       0        5        125/96   25/48
        0     0       0       0        0        5/48     1/24
        0     0       0       0        0        0        1/10 ];
  E = [1/20;  0;  -81/160;    6/5;     -25/32;  -1/16;   1/10 ];
end,
	g = zeros(length(y0),7);
	
% hA = h * A;
  hB = h * B;
  g(:,1) = g0;
  g(:,2) = feval(ode,y0+g*hB(:,1));
  g(:,3) = feval(ode,y0+g*hB(:,2));
  g(:,4) = feval(ode,y0+g*hB(:,3));
  g(:,5) = feval(ode,y0+g*hB(:,4));
  g(:,6) = feval(ode,y0+g*hB(:,5));
  ynew = y0+g*hB(:,6);  gnew = feval(ode,ynew);  g(:,7) = gnew;
  ye = y0 + g*hB(:,7);  ge = feval(ode,ye);
  
  erry = 2.*norm(ynew-ye)./(norm(ynew-y0)+norm(ye-y0));
  errg = 2.*norm(gnew-ge)./(norm(gnew-g0)+norm(ge-g0));
  
return;