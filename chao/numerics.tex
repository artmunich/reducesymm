\ifsvnmulti
\svnkwsave{$RepoFile: siminos/chao/numerics.tex $}
\svnidlong {$HeadURL$}
{$LastChangedDate$}
{$LastChangedRevision$} {$LastChangedBy$}
\svnid{$Id$}
\fi


\chapter{Numerics}
\label{chap:numerics}


\section{Numerical simulations of KS}
\label{s:KSnumerical}

\begin{description}

\item[2011-08-24 PC to Chao]
Please describe here your progress with numerical simulations.

\item[2011-09-09 PC to ES]
Please do not to repeat the mistakes of your graduate student years, Chao
is under strict orders to enter into the blog everything he learns as he
learns it, so do not share secrets by email, enter them - I would also
like to learn how to run your KS codes.

\item[2011-03-16 PC to Ruslan and Evangelos]
   Chao Shi, shichao116@gmail.com is starting (rather late) to work on
   slicing and dicing \KS\ as a 1st year graduate student
   project. Hopefully we can get him to speed with your and Stefan's help
   within the next six months. At the moment he is reading parts of
   ChaosBook and our articles, but it might be wise that you teach him
   immediately how to use your KS programs and data, so we do not waste
   time on that. Chao can compute. He says.

\item[2011-03-29 Ruslan]
Hi Chao.  If you want to use Matlab for your explorations of the \KS,
then all my Matlab files can be found in /siminos/chao/matlab/ruslan.
File ksdupo.m is the primary file.  I'm using the cells feature of
Matlab, so this file contains many sections that can be run
independently.  There is not much in the way of comments, so you'll have
to work it out for yourself.  I'll be happy to guide you through it if
you ask specific questions.

\item[2011-04-10 ES to CS] Chao, my Fortran 90 code to integrate KSe, find
\po s etc is in the svn repository \texttt{vaggelis}. The file 00README.txt
explains what you'll find in each directory. The basic routines in the
directory \texttt{libraries} are in general well documented. The driver routines in
\texttt{testing} and \texttt{production} are less well documented. In most
low-level directories there are three subdirectories (branches, trunk and tags).
The current code is always in trunk, ignore the rest. I think that, for what you
will have to do, you will find Ruslan's matlab code easier to use (KSe is not that
expensive to integrate in terms of CPU time, at least for small system size). In any
case I'd be glad to answer your questions about where to find what and how to
use the code.

\item[2011-09-06 PC to ES]
Chao would like to get started on numerical work, so I told him to
    \texttt{svn checkout vaggelis}
and he did - I saw the file system on his machine with my very own eyes.

Now he's done something \textbf{scary} with it (looks like he has added svn configuration
files as repository files?) - I will not touch it until you make sure it is healthy and
instruct him to do the right thing, both with this repository, and what codes to start
testing.

\begin{verbatim}
Added:
  README.txt
  conf/
  conf/authz
  conf/passwd
  conf/svnserve.conf
  db/
  db/current
  db/format ...
\end{verbatim}

\item[2011-09-09 PC to ES]
I'll try to replace Chao's 'enhanced' \texttt{vaggelis} repository by a
pre-chaos CNS backup on Tuesday. In the meantime, can you two guys skype
each other: he has the \texttt{vaggelis} repository and is sworn not to
check in anything more into it until such time you let him.

\item[2011-09-25 PC to ES]
Restoring this has been a major pain, I've spent at least 3 hours
plugging in various backup drives so far... I have a copy from
\begin{verbatim}
2011-04-10 srv/svn/repos/vaggelis/db/revs/1120
\end{verbatim}
Would that be good enough?
Now I have checked, and \texttt{rev. 1120} is the last before Chao's
magic touch,
so I'll go ahead and attempt to restore it from zero backups. Instructions
are \HREF{http://www.cns.gatech.edu/CNS-only/backupInstr.txt}{here}.
Need to be superuser.
Find the files you need from the list, then extract them
\begin{verbatim}
cd /mnt/auto/sdd/current
less /mnt/auto/sdd/current/zero\_1.lst
cd ~/tmp/
tar xvfz /mnt/auto/sdd/previous/zero\_1.tgz \
         srv/svn/repos/vaggelis/
\end{verbatim}
can take 3 hours - going through at least 3GB on a USB drive.
I finally succeeded. There is also a backup on \texttt{one.physics},
which is much easier to use; can even use
it remotely - but it did not work for me (the GUI froze)

Please rename your version of \texttt{vaggelis}, svn check out the
current one, check it out, then {\em delete} the old one,
so there is no chance of Chao's contamination returning into the repository.
Thanks!

\item[2011-09-26 ES to PC]

Yes, \texttt{rev. 1120} is the one we need. The hole directory vaggelis will have
to be replaced so that there are no lingering internal svn files left.

\end{description}

\section{Fortran notes}
\label{s:fortran}

\begin{description}

\item[2011-09-09 PC to ES]
I tried to find the \texttt{00README.txt} documentation that you mention
above, and I failed, and he is floundering around; seems to be reading
either \texttt{Fortran 95} manuals or girlie magazines. I cannot tell.
It's all in Chinese.

If we need to install some libraries, I can do it - KGB does not control
everything, as yet.


\item[2011-09-11 CS to ES] Finished scanning Fortran user guide, in order
to deal with the psychological block of reading fortran90 code. Still
have to get used to compiling and debugging in a terminal. Evangelis, can
we make an appointment for skyping? I need some guidance to start
understanding and testing your code. I'm available almost anytime in the
afternoon and night. Thanks!

\item[2011-09-11 PC] When it is 3pm in Atlanta it is 9pm in Dresden.

\item[2011-09-25 Chao to Evangelos]
Hi Evangelos, now I want to start doing the integration of \KSe. I guess the code you used for integration is in vaggelis/libraries/integr/truck. There're many source code files in it. Would you please give me some direction about the function of different files and the numeric methods you used for integration? Thanks!

Specifically, in the file \texttt{ifc\_integr.f90}, I found the declaration of these basic functions or routines: MatVar, derivs, SetNlin, SetAndiag, integrator, integratorJ. But I couldn't find there definition the whole directory, are they included in other MODULEs?

\item[2011-09-26 Evangelos to Chao] Chao, how experienced are you with
code development in linux? I'll try to answer your questions assuming some
experience, but please let me know if you need more explicit instructions.
Also, what is your programming experience? Which languages are you familiar
with and in what enviroments?

\item[2011-09-26 Chao to Evangelos] Thanks. I'm familiar with C in windows enviroment, so I have little experience with code development in linux. I'll try to figure out what you said

\item[2011-09-26 Evangelos to Chao] In a nutshell, the code is organized in
several libraries, each in each own directory. Directory named trunk contains
the main line of developement. The one you have to compile first is in
vaggelis/libraries/nr/trunk (these are numerical recipes headers taken from
nr.com). You have to run the command \textbf{make} and if this compiles without
problem run \textbf{make install}. Most probably there will be problems, so you
will have to read vaggelis/libraries/nr/trunk/makefile to understand what's
wrong, or send me the error message.

The library integr only requires the presence of nr in your system to compile
correctly (and some system libraries, \eg\ fftw3).

Reading  parts of ``Numerical Recipes in Fortran 90,'' might help you,
as the organization of the code follows the strategy layed out there.
Regarding numerical algorithms, I implement ETDRK4 scheme of Kassam and
Trefethen\rf{ks05com}.

Once the repository vaggelis is up and running I'll try to improve the
documentation. Meanwhile, let me know how it goes. It might be more efficient
to just skype me if you see me online (but I'm trying to get settled down in
Dresden so I am usually offline).

\item[2011-09-26 Chao to Evangelos] The error message after running make command:

rm -f /home/cshi31/lib-/modules/nrtype.mod nr.mod nrutil.mod\\
rm -f /home/cshi31/lib-/libnr.a\\
c  -o nrtype.o  nrtype.f90 \\
make: c: Command not found\\
make: [nrtype.mod] Error 127 (ignored)\\
c  -o nrtype.o  nrtype.f90 \\
make: c: Command not found\\
make: [nrtype.o] Error 127 (ignored)\\
c  -o nr.o  nr.f90 \\
make: c: Command not found\\
make: [nr.o] Error 127 (ignored)\\
c  -o nrutil.o  nrutil.f90 \\
make: c: Command not found\\
make: [nrutil.o] Error 127 (ignored)\\
ar cr libnr.a nrtype.o nr.o nrutil.o \\
ar: nrtype.o: No such file or directory\\
make: *** [libnr] Error 1\\

\item[2011-09-26 Evangelos to Chao] Before I can explain what to do:
What fortran compiler do you use/plan to use?
The code is tested with Intel's ifort, which I hope is installed there (you
could maybe install it yourself, within your account if the free academic use
version still exists).

\item[2011-09-28 Chao to Evangelos]I find the manual for gfortran so I think I'm using the GNU Fortran 95 compiler bulit in the machine. What's the command you use when compiling with ifort? I don't think it's installed.

\item[2011-09-28 Evangelos 2 Chao]You invoke intel fortran by the command ifort. If it's not installed on the CNS network or some cluster, then there is not much you can do
(if you are research assistant you don't qualify for a non-commercial licence). How do you invoke gfortran?

\item[2011-09-29 Chao to Evangelos] I tried ifort but ``command not found''. I invoke gfortran with ``gfortran'' or ``f95''

\item[2011-10-04 Evangelos]
\begin{enumerate}
 \item Create a folder lib-gfortran in your home directory.
 \item Within lib-gfortran create subdirectory modules.
 \item In your .bashrc file add the line:
  \verb| export COMP=gfortran |
 \item Run make in nr directory (start a new terminal)
\end{enumerate}
Works for me!

\item[2011-10-10 Chao]
Evangelos would you mind explaining ``subdirectory modules'' a little bit? Sorry that I'm a beginner in linux and fortran. Thanks!

\item[2011-10-12 Chao]
Hi Evangelos, it seems that add ``export COMP=gfortran'' in .bashrc file doesn't work. I just define COMP=gfortran in the makefile. And I copied nrtype.f90 nr.f90 nrutil.f90 to folder lib-gfotran\ moudules. Then it generates three .mod files, three .o files and libnr.a. It means it works now right? What should I do next?

\item[2011-10-11 Predrag and Chao]
Had a long chat. Predrag said that he does not understand what Chao does with his time -
on his RA he has no obligations other than science, while Predrag also teaches, grades
problem sets, writes papers, proposals, organizes seminars, colloquia \emph{und so weiter}. As
an experiment, Predrag stopped writing Chaos's blog on Sept 19 and nothing (in terms of
research progress, literature, things learned) has been written into it since.
Predrag had expected
to have a rough draft of Davidchack et al. paper II, with KS dynamics sliced and the
infamous 40,000 (60,000?) \rpo s organized in happy families. Predrag believes that
starting computing should be very easy, as number of people, including Predrag's
undergraduate nonlinear dynamics class, have learned it in matter of
weeks (including Predrag, working with Pukaradze and Christiansen), and here everything
is set up. Nothing that we had agreed on (see \refpage{chap:blog}) has been carried out.

Chao explained that he feels that he must understand what he is doing, and that
he has read many papers. He has downloaded a book on infinite-dimensional systems that
seems to have a good chapter on \KS. But he should organize his time differently,
and spend 1/2 on computing, and 1/2 on reading. This was followed by much embarrassing
Predrag's windbaggery, who even dragged in dead Feynman as a possible model on how to do
science.

Predrag's
2007 GaTech undergraduate nonlinear dynamics class
Kuramoto-Sivashinsky reports:
\HREF{http://chaosbook.org/extras/KSEproject/KSEbiffs.html}{1. A fishing expedition},
\HREF{http://chaosbook.org/extras/KSEproject/ks_sim.html}{2. Flickering flame front}.


\item[2011-10-12 Chao 2 Predrag] I plan to write my own code if I can't demystify
Simino's code in short time.

\item[2011-10-12 Predrag 2 Ruslan and Evangelos]
What do you think?

My personal feeling it would be a waste of time, as you both have well developed
codes that work and
it would be much more economical to add to them than start from the scratch.

\item[2011-10-12 Ruslan]
I agree that it's a waste of time.  I don't know about Evangelos's code,
but my Matlab code shouldn't be hard to use.  It's fairly modular and
there are just a few key function files, which most of the time can
be used as black boxes.

For initial exploration, Matlab is preferable since the code is smaller
and visualization of results directly available, but, as a rule of thumb,
if it takes about 1 hour for Matlab code to compute the result,
then it's time to start thinking about moving to Fortran or C.

Seems to me that Evangelos didn't find it hard to start changing my Matlab
functions once I explained a few things in the README file last week.
Of course I'm partial, but with Matlab you don't have to spend time worrying
about compiles, makefiles, etc.

Of course, if Chao doesn't know Matlab, it might appear difficult
for him to start using it.


\item[2011-10-12 Evangelos]
I knew virtually no Matlab when I started using Ruslan's code
- so it should be no problem for Chao to learn how to use it. My code
is written in Fortran 90 and is therefore a bit harder to compile and
use (also the user interface is not great). For what Chao is expected
to work on in the near future there should be no serious performance
penalty. So I think Ruslan's Matlab code should be the first think to
master, then if there is need for Fortran or C code he can either try
to use my code or write his own.

\item[2011-10-12 Predrag]
To summarize, continuing on what we agreed on \refpage{chap:blog}:
We advise Chao to get Ruslan's Matlab simulations running, and by the
end of this month discuss how far we have gotten, and
whether it is realistic to continue with this project.

\item[2011-10-12 Chao]
Thanks for all of your advice. This morning I also found that Matlab is
much easier to use and now I'm running the code of integrating \KSe  with
ETDRK4 scheme from \rf{ks05com} which works well. So I'll turn to
exploring Ruslan's code.

\end{description}

\section{Matlab notes}
\label{s:matlab}

\begin{description}

\item[2011-10-12 Chao to Ruslan]
Hi Ruslan, sorry to bother you. I tried to run every cell but almost every cell has errors. Most commonly are undefined functions, undefined variables, and unable to read file because ``No such file or directory''. Do I miss some packages or data files? Thanks.

\item[2011-10-13 Ruslan 2 Chao]  Now, why would you do that!  It's like getting into the cockpit of an airplane and start pushing every button you see there and then saying "Well, it doesn't fly...".  You actually need to understand what you are doing.  Start by reading the README file in matlab/ruslan.  Focus on the bits of the ksdupo.m file which I mention there, try to understand what they do and how they do it.  Ask specific questions.  I'll try to answer promptly.

\item[2011-10-13 Chao to Ruslan] I read the file ksfmetd2.m of KS Solver which uses ETDRK4 scheme from \rf{ks05com}. Therefore I understand the main idea but have some specific questions:

1, What are variables $\textit{nargin}$ and $\textit{nargout}$ for? I didn't find the definition in the main file ksdupo.m.

   There are three main if...else... blocks controlled by the value of nargout. The code between if...else and after else are doing basically the same thing except some difference related to nargout. Probably I will understand why you have to extend those coefficient matrix to N*M(N-1) if I know the function of nargout. Or would you just explain that to me together? :)

2, For array $\textit{y1,v0p,vp,y0p}$, why do they throw away the first element in array $\textit{v}$?

3, Why is $\textit{da}$ Jacobian as you said in the comment ahead of the main code. It seems that $\textit{da}$ is just $\textit{ys}$ without the first element(here again, why get rid of the first one?) while $\textit{ys}$ is just the final value interpolated from $\textit{v}$ which is the value of $\mu(t)$ in Fourier space. I think this is related to line 20 and 21 where you set some particular elements of $\textit{v}$ to 1 but not sure because of the first question.

4, Where is the interpolation formula from?

\item[2011-10-13 Ruslan 2 Chao]

1. Variables $\texttt{nargin}$ and $\texttt{nargout}$ allow Matlab functions to use variable number of input and output arguments.  Type 'doc nargin' at Matlab prompt to find out more.  In general, if you don't understand something about Matlab language, read help.  In this particular case, if the number of output arguments is less than 3, then calculation of the Jacobian is not required.

2. Because the first element is the 0-th Fourier mode, which is always zero (see line 16).

3. This is a standard way to compute Jacobian through variational equations.  If you have $N$ ODEs and want to calculate full Jacobian of the solution, then you augment the $N$ ODEs with $N^2$ variational ODEs into a single $N(N+1)$ dimensional system.  I'm sure you can read about this in any standard dynamical systems text.

4. I'm sure it can be found somewhere, but it's easy to derive.  It's just a cubic polynomial passing through two given end points ($\texttt{y0}, $\texttt{y1}) with specific slopes $\texttt{y0p}, $\texttt{y1p}).  So, there are 4 conditions which can be used to find the 4 coefficients of the cubic.

\item[2011-10-14 Chao to Ruslan]
In line 18 to 19, v is defined as [zeros(1,N-1); [a0(1:2:end-1)+1i*a0(2:2:end) zeros(Nh-1,N-2)]; ...
zeros(1,N-1); [a0(end-1:-2:1)-1i*a0(end:-2:2) zeros(Nh-1,N-2)]];. I'm curious that would the submatrix [a0(1:2:end-1)+1i*a0(2:2:end) zeros(Nh-1,N-2)] be legally defined in this function since the dimensions of a0 and zeros(Nh-1,N-2) are different? I tried simpler versions [a(1:2:end-1), zeros(2,4)] [zeros(1,10),[a(1:2:end-1), zeros(2,4)]] in command mode which both invoked error message.

I mean that in line 18 and 19 of the file ksfmetd2.m the vector v when nargout>3 is defined. But it seems that one the subvector of v [a0(1:2:end-1)+1i*a0(2:2:end) zeros(Nh-1,N-2)] is not correctly defined because it is directly composed of two parts: \textbf{a0(1:2:end-1)+1i*a0(2:2:end)} and \textbf{zeros(Nh-1,N-2)} which obviously have different dimensions. The former is an one dimensional array while the latter is a matrix of Nh-1 by N-2. As I mentioned above I tried two vectors of the same type as this one and both of them have error says dimensions are not consistent. So I am asking if my judgement is correct. If it does have problem, what's the correct form? Thanks!

\item[2011-10-15 Ruslan 2 Chao]
If you don't think the code is correct, but it's working fine (which it does), then obviously it's not the code but your understanding of it that is not right.  So you need to think harder before asking such questions.  In this case we are composing a column vector of length Nh-1 and an Nh-1 by N-2 matrix, so the result is an Nh-1 by N-1 matrix.  I think that it should be rather trivial to figure this out.  I'm afraid that if you keep asking these types of questions, we are not going to get very far...

\item[2011-10-16 Chao to Ruslan]
Copied and slightly modified the file ksfmetd2.m to an independent routine by changing the input arguments to variables or constants defined in the program and assigning proper initial values as in \rf{ks05com}. Thus I can test it independently

In detail I defined the initial function $\mu(x,0)=cos(x/16)*(1+sin(x/16))$ in real space where $x = 32*pi*(1:N)'/N$ and $N =128$.  It runs well with no errors but the result of integration diverges. I'm trying to figure out the problem

Sorry for the stupid question last time and thanks for the advice. You're right I should think harder before asking these types of questions. It turns out the embarrassing reason why I was stuck is just that I never thought a0 could be a column vector.

\item[2011-10-17 Ruslan 2 Chao]
That's OK.  I know Matlab notations might be confusing at first.  A suggestion: I have transformed Kassam and Trefethen's code into a function so it is easier to use, so it does not make sense for you transform it back into the script file.  Instead, why don't you start learning how to use function \texttt{ksfmetd2} in the context of whatever problem Predrag assigned for you to do?

\item[2011-10-17 Chao] Been able to plot RPOs dynamically in real or Fourier space, by calling function \texttt{ksfmetd2}

\item[2011-10-19 Chao 2 Predrag] Do you want me to visualize the
trajectory of \KS\ \rpo s dynamically as the one in the
ChaosBook.org/\-tutorials dual visualizations, $(a_1,a_2)$
projection?

\item[2011-10-20 Predrag] In this spirit. There are such visualizations
in \refrefs{SiminosThesis,SCD07}, and in siminos/blog,
Figs.~3.1, 12.6, 12.8, 12.9. You should at least be able to
produce visualizations such as Fig.~39 ``The relative periodic orbit with $(\period{p}, \shift_p) = (33.5, 4.04)$,
...''

\item[2011-10-21 Chao] Summary of plot RPOs in co-moving coordinate in Fourier space. 
Suppose we have a RPO with shift $\textit{$l_p$}$, $\mu(x+\textit{$l_p$},\textit{$T_p$})=\mu(x,0)$. Let $x'=x+t\textit{$l_p$}/\textit{$T_p$}$, then obviously $\mu(x',t)$ saftisfies periodic condition, which is equivalent to express $\mu(x,t)$ in the co-moving frame with velocity $\textit{$l_p$}/\textit{$T_p$}$.  Translational property of Fourier transformation gives $\textit{F}(\mu(x+t\textit{$l_p$}/\textit{$T_p$},\textit{t})) = exp(-ikt\textit{$l_p$}/\textit{$T_p$})\textit{F}(\mu(x,t))$, where \textit{F} denotes Fourier transform. Thus in order to obtain the Fourier modes tranformed from co-moving real space, we just multiply the original one with a time-dependent prefactor, which is just a point-wise product of two matrix in Matlab.  
\end{description}
