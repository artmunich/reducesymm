(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     14209,        427]
NotebookOptionsPosition[     12863,        385]
NotebookOutlinePosition[     13201,        400]
CellTagsIndexPosition[     13158,        397]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.544772277445504*^9, 3.54477229320197*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dataDir", "=", "\"\<../../matlab/ruslan/\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.552800750254986*^9, 3.55280077628544*^9}, 
   3.552800879776054*^9}],

Cell[BoxData[
 RowBox[{"dataDir", "<>", "\"\<ks22tw1manif.mat\>\""}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"d", "=", "62"}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"state", " ", "space", " ", "dimension", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"real", " ", "numbers"}], ",", " ", 
      RowBox[{"not", " ", "counting", " ", "zero", " ", "mode"}]}]}]}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.552807718215145*^9, 3.5528077241562653`*^9}, {
   3.5528091657211637`*^9, 3.5528092263*^9}, 3.552811742947341*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dF", "=", "31"}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"n", "/", "2"}], "-", "1"}], ",", " ", 
    RowBox[{
    "where", " ", "n", " ", "the", " ", "number", " ", "of", " ", "Fourier", 
     " ", "modes", " ", "counting", " ", "zero", " ", "mode"}]}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.552808681189241*^9, 3.552808683435706*^9}, {
  3.552808829336174*^9, 3.552808829912114*^9}, {3.552809099887903*^9, 
  3.5528091606272593`*^9}}],

Cell["\<\
Import set of trajectories (here for unstable manifold of TW1). (Nic x \
d)-rows Nsteps-columns, where Nic the number of initial conditions, d the \
state-space dimension, Nsteps the number of time steps.\
\>", "Text",
 CellChangeTimes->{{3.552807455791*^9, 3.552807556805904*^9}, {
  3.5528076344076014`*^9, 3.552807656784021*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"tw1manif", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"dataDir", "<>", "\"\<ks22tw1manif.mat\>\""}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.5528007465681257`*^9, 3.552800748038217*^9}, {
  3.5528007806200523`*^9, 3.5528008069581947`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"tw1manif", "[", 
   RowBox[{"[", "1", "]"}], "]"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.552801089506373*^9, 3.552801118195973*^9}}],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{"tw1manif", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", 
       RowBox[{"1", ";;", 
        RowBox[{"-", "1"}], ";;", "d"}], ",", "10"}], "]"}], "]"}], " ", ",", 
    
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], " "}]], "Input",
 CellChangeTimes->{{3.552807712164474*^9, 3.552807814801206*^9}, {
  3.552808087934038*^9, 3.552808088117271*^9}, {3.552811756180105*^9, 
  3.552811775245401*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"tw1manif", "[", 
   RowBox[{"[", "1", "]"}], "]"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.5528078290409603`*^9, 3.552807830957337*^9}, {
  3.552808070325387*^9, 3.5528080715241623`*^9}}],

Cell[BoxData[
 RowBox[{"Length", "[", 
  RowBox[{"Table", "[", 
   RowBox[{"i", ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", "1", ",", "0.06"}], "}"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.552801787729073*^9, 3.5528018141503572`*^9}, {
  3.5528073675991287`*^9, 3.552807367744475*^9}, {3.5528074040235233`*^9, 
  3.552807404727178*^9}}],

Cell[BoxData[
 RowBox[{"1054", "/", "17"}]], "Input",
 CellChangeTimes->{{3.552801820762611*^9, 3.552801823251999*^9}}],

Cell[BoxData[
 RowBox[{"901", "/", "17"}]], "Input",
 CellChangeTimes->{{3.5528018263635483`*^9, 3.552801828076344*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rpo1", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"dataDir", "<>", "\"\<ks22rpo16p31s2.86.mat\>\""}], "]"}]}], " ", 
  ";", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{",", "\"\<LabeledData\>\""}], "]"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.552801518527114*^9, 3.552801548311242*^9}, {
  3.552807037342886*^9, 3.552807105624515*^9}, {3.552807161802136*^9, 
  3.552807194657419*^9}, {3.5528072617863483`*^9, 3.552807272749201*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rpo1", "[", 
   RowBox[{"[", "1", "]"}], "]"}], "//", "Dimensions"}]], "Input",
 CellChangeTimes->{{3.552807663004777*^9, 3.5528076690117188`*^9}, {
  3.55281180832279*^9, 3.5528118094315567`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotList", "[", 
   RowBox[{"th_", ",", "dF_"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"I", " ", "k", " ", "th"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"k", ",", "1", ",", "dF"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.552808640802899*^9, 3.5528086716880093`*^9}, {
  3.552808835075783*^9, 3.552808836060569*^9}, {3.5528096462327423`*^9, 
  3.552809648896393*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rot", "[", 
    RowBox[{"th_", ",", "dF_"}], "]"}], ":=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"rotList", "[", 
     RowBox[{"th", ",", "dF"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.548427112726866*^9, 3.548427124978426*^9}, {
   3.548427158648355*^9, 3.548427187798277*^9}, {3.548427506979024*^9, 
   3.548427508487605*^9}, 3.552209100441189*^9, {3.552209849819571*^9, 
   3.552209850014653*^9}, {3.552808845674499*^9, 3.552808849482868*^9}, {
   3.552809657854862*^9, 3.55280966440753*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "rotDer", "]"}]], "Input",
 CellChangeTimes->{{3.5528118857917957`*^9, 3.5528118901017027`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rotDer", "[", 
    RowBox[{"th_", ",", "dF_"}], "]"}], "=", 
   RowBox[{"D", "[", 
    RowBox[{
     RowBox[{"rot", "[", 
      RowBox[{"th", ",", "dF"}], "]"}], ",", "th"}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.552808997366342*^9, 3.552809034503805*^9}, {
   3.552809669135126*^9, 3.552809675943955*^9}, 3.552811894054639*^9, 
   3.5528119528486958`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotGen", "=", 
   RowBox[{"rotDer", "[", 
    RowBox[{"0", ",", "dF"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.552809014008534*^9, 3.552809047911495*^9}, {
  3.552809681143839*^9, 3.552809682366577*^9}, {3.552811895853447*^9, 
  3.552811956847742*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sliceCond", "[", 
   RowBox[{"x_List", ",", "templ_List", ",", "th_", ",", "dF_"}], "]"}], ":=", 
  RowBox[{"ComplexExpand", "[", 
   RowBox[{"Re", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Conjugate", "[", "x", "]"}], ".", 
       RowBox[{"rot", "[", 
        RowBox[{
         RowBox[{"-", "th"}], ",", "dF"}], "]"}]}], ")"}], ".", 
     RowBox[{"(", 
      RowBox[{"rotGen", ".", "templ"}], ")"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.548427646283306*^9, 3.5484277403844213`*^9}, 
   3.548428010959774*^9, 3.548428164535964*^9, {3.548442212620851*^9, 
   3.548442221396084*^9}, {3.5484422716196423`*^9, 3.548442279619231*^9}, {
   3.55281185136873*^9, 3.5528118595365067`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sliceCond", "[", 
   RowBox[{"x_List", ",", "templ_List"}], "]"}], ":=", 
  RowBox[{"ComplexExpand", "[", 
   RowBox[{"Re", "[", 
    RowBox[{
     RowBox[{"Conjugate", "[", "x", "]"}], ".", 
     RowBox[{"(", 
      RowBox[{"rotGen", ".", "templ"}], ")"}]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.548442820949328*^9, 3.548442839096561*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rot2chart", "[", 
   RowBox[{"x_List", ",", "templ_List", ",", "dF_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"thSol", ",", "xRot", ",", "nrm"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"thSol", "=", 
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"sliceCond", "[", 
          RowBox[{"x", ",", "templ", ",", "th", ",", "dF"}], "]"}], 
         "\[Equal]", "0"}], ",", "th"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"xRot", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"rot", "[", "th", "]"}], ".", "x"}], ")"}], "/.", 
       "thSol"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nrm", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Norm", "[", 
          RowBox[{"#", "-", "templ"}], "]"}], "&"}], ",", "xRot", ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xRot", "[", 
       RowBox[{"[", " ", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"nrm", ",", 
           RowBox[{"Min", "[", "nrm", "]"}]}], "]"}], "//", "First"}], " ", 
        "]"}], "]"}], "//", "First"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.552812002102654*^9, 3.552812012251266*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rot2slice", "[", 
   RowBox[{"x_List", ",", "templ_List", ",", "dF_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "xRot", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xRot", "=", 
      RowBox[{"rot2chart", "[", 
       RowBox[{"x", ",", 
        RowBox[{
        "templ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
        ",", "dF"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sign", "[", 
         RowBox[{"sliceCond", "[", 
          RowBox[{"xRot", ",", 
           RowBox[{
           "templ", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          "]"}], " ", "]"}], "\[Equal]", 
        RowBox[{"Sign", "[", 
         RowBox[{"sliceCond", "[", 
          RowBox[{
           RowBox[{
           "templ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{
           "templ", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"xRot", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rot2chart", "[", 
          RowBox[{"x", ",", 
           RowBox[{
           "templ", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
           ",", "dF"}], "]"}], ",", "2"}], "}"}]}], " ", "]"}]}]}], 
   RowBox[{"(*", 
    RowBox[{"Check", " ", "ridge", " ", "crossing"}], "*)"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.55281704039198*^9, 3.5528170664368973`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rot2chartTraj", "[", 
   RowBox[{"traj_List", ",", "templ_List", ",", "dF_"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rot2chart", "[", 
      RowBox[{"#", ",", "templ", ",", "dF"}], "]"}], "&"}], ",", "traj", ",", 
    "1"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.552817379747765*^9, 3.552817385044036*^9}}],

Cell[BoxData[
 RowBox[{"rpo1", "[", 
  RowBox[{"[", 
   RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trajRe2c", "[", "x_List", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"x", "[", 
      RowBox[{"[", 
       RowBox[{"i", ",", 
        RowBox[{"1", ";;", 
         RowBox[{"-", "1"}], ";;", "2"}]}], "]"}], "]"}], "+", 
     RowBox[{"I", " ", 
      RowBox[{"x", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", 
         RowBox[{"2", ";;", 
          RowBox[{"-", "1"}], ";;", "2"}]}], "]"}], "]"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], " ", "]"}]}]], "Input",
 CellChangeTimes->{{3.5528179161354322`*^9, 3.552818048764965*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rpo1c", "=", 
   RowBox[{"trajRe2c", "[", 
    RowBox[{"Transpose", "[", 
     RowBox[{"rpo1", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.552818054554839*^9, 3.552818095994666*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "rpo1c", "]"}]], "Input",
 CellChangeTimes->{{3.552818097537883*^9, 3.552818105816514*^9}}],

Cell[BoxData[
 RowBox[{"rot2chartTraj", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"rpo1", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "//", "Transpose"}], " ", ",", 
   RowBox[{"rpo1", "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}], ",", "dF"}], " ", 
  "]"}]], "Input",
 CellChangeTimes->{{3.5528172935324593`*^9, 3.5528173718831367`*^9}}]
},
WindowSize->{740, 1108},
WindowMargins->{{Automatic, 370}, {Automatic, 14}},
FrontEndVersion->"8.0 for Linux x86 (64-bit) (October 10, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 138, 2, 29, "Input"],
Cell[698, 24, 191, 4, 29, "Input"],
Cell[892, 30, 79, 1, 29, "Input"],
Cell[974, 33, 458, 11, 29, "Input"],
Cell[1435, 46, 515, 13, 29, "Input"],
Cell[1953, 61, 342, 6, 47, "Text"],
Cell[2298, 69, 287, 7, 29, "Input"],
Cell[2588, 78, 184, 4, 29, "Input"],
Cell[2775, 84, 488, 13, 29, "Input"],
Cell[3266, 99, 237, 5, 29, "Input"],
Cell[3506, 106, 362, 9, 29, "Input"],
Cell[3871, 117, 119, 2, 29, "Input"],
Cell[3993, 121, 120, 2, 29, "Input"],
Cell[4116, 125, 471, 11, 29, "Input"],
Cell[4590, 138, 232, 5, 29, "Input"],
Cell[4825, 145, 467, 12, 29, "Input"],
Cell[5295, 159, 567, 12, 29, "Input"],
Cell[5865, 173, 133, 2, 29, "Input"],
Cell[6001, 177, 415, 12, 29, "Input"],
Cell[6419, 191, 296, 7, 29, "Input"],
Cell[6718, 200, 755, 18, 48, "Input"],
Cell[7476, 220, 386, 10, 29, "Input"],
Cell[7865, 232, 1380, 40, 120, "Input"],
Cell[9248, 274, 1630, 44, 102, "Input"],
Cell[10881, 320, 382, 10, 29, "Input"],
Cell[11266, 332, 116, 3, 29, "Input"],
Cell[11385, 337, 677, 20, 29, "Input"],
Cell[12065, 359, 285, 8, 29, "Input"],
Cell[12353, 369, 133, 2, 29, "Input"],
Cell[12489, 373, 370, 10, 29, "Input"]
}
]
*)

(* End of internal cache information *)
